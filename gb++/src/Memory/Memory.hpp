#ifndef MEMORY_HPP
#define MEMORY_HPP

#include <cstdint>
#include <string>
#include <iostream>
#include <fstream>

#include "../Sharp/Sharp.hpp"
#include "../PPU/PPU.hpp"

class Memory {
	uint8_t* HighRAM;    // High RAM located at	0xFF80: 127 bytes
	uint8_t* IO;         // IO register located at 0xFF00: 128 bytes
	uint8_t* SpriteOAM;  // Video RAM located at 0xFE00: 160 bytes
	uint8_t* WorkingRAM; // Working RAM located at 0xC000 (mirrored at 0xE000): 8 kilobytes
	uint8_t* ExtRAM;	 // External RAM located at 0xA000: 8 kilobytes
	uint8_t* VideoRAM;   // Video RAM located at 0x8000: 8 kilobytes
	uint8_t* Cartridge;  // Cartridge ROM beginning at 0x0000: 32 kilobytes
	uint8_t* BootROM;

	Sharp* CPU; // The Memory class will need to tick the CPU itself

	const uint8_t IOPowerOn[0x80]{
		0xCF, 0x00, 0x7E, 0x00, 0xAB, 0x00, 0x00, 0xF8,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE1,
		0x80, 0xBF, 0xF3, 0xFF, 0xBF, 0x00, 0x3F, 0x00,
		0xFF, 0xBF, 0X7F, 0xFF, 0x9F, 0xFF, 0xBF, 0x00,
		0xFF, 0x00, 0x00, 0xBF, 0x77, 0xF3, 0xF1, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x91, 0x85, 0x00, 0x00, 0x90, 0x00, 0xFF, 0xFC,
		0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xFF,
		0x00, 0xFF, 0XFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

	const int TimerControl[4] {
		1024,
		  16,
		  64,
		 256
	};

public:
	PPU* GPU;

	uint8_t InterruptEnableRegister; // Interrupt Enable Register located at 0xFFFF: 1 byte
	uint8_t* InterruptFlags;

	bool BootROMEnable = true;

	// Ticks
	int64_t SystemCycles;
	int64_t SystemCyclesTMA;

	Memory();
	~Memory();

	void WriteWord(uint16_t address, uint8_t data);
	uint8_t ReadWord(uint16_t address);

	void WriteDoubleWord(uint16_t address, uint16_t data);
	uint16_t ReadDoubleWord(uint16_t address);

	void OAMDMACopy();

	void UpdateTimer();

	// This is a temporary function
	bool CartridgeLoader(std::string filename);
	bool LoadBootRom();

	void Clock();
};

#endif
